# 模块的加载机制

## 优先从缓存中加载

模块在第一次加载后会被缓存

## 内置模块的加载机制

内置模块是由 Node.js 官方提供的模块，内置模块的加载优先级最高

如：`require('fs')` 始终返回内置的 `fs` 模块，即使在 `node_modules` 目录下有名字相同的包也叫 `fs`

## 自定义模块的加载机制

使用 `require()` 加载自定义模块时，必须指定以 `./` 或 `../` 开头的路径标识符

同时，在使用自定义模块时，如果省略了文件扩展名，则会按以下顺序尝试加载：

- 1、按照确切的文件名
- 2、补全 `.js` 扩展名
- 3、补全 `.json` 扩展名
- 4、补全 `.node` 扩展名
- 5、加载失败，报错

## 第三方模块的加载机制

如果传递给 `require()` 的模块标识符不是一个内置模块，也不是以 `./` 或 `../` 开头，则会从当前模块的父目录开始，尝试从 `node_modules` 目录中加载第三方模块

如果没有找到，则移动到再上一层父目录中，直到文件系统根目录

## 目录作为模块

当把目录作为模块标识符，传递给 `require()` 加载时，有三种加载方式：

- 1、在被加载的目录下查找 `package.json` 文件，并寻找 `main` 属性作为加载入口
- 2、如果目录中没有 `package.json`，或者 `main` 入口不存在或无法解析，则尝试加载目录下的 `index.js` 文件
- 3、如果以上两步都失败，则会报错
